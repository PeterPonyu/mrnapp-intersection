(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{8818:function(e,t,n){Promise.resolve().then(n.bind(n,8797))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},8797:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var r=n(7437),a=n(2265),s=n(9376),c=n(7268);function l(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),[n,l]=(0,a.useState)([]),[u,d]=(0,a.useState)(""),[h,p]=(0,a.useState)("up"),[g,j]=(0,a.useState)(null),[y,v]=(0,a.useState)(!0),[b,N]=(0,a.useState)(!1),[w,S]=(0,a.useState)("chart"),[P,_]=(0,a.useState)(50),[O,R]=(0,a.useState)("Adjusted P-value"),[k,A]=(0,a.useState)("asc"),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{(0,c.vj)().then(t=>{var n;l(t),d(e.get("comparison")||(null===(n=t[0])||void 0===n?void 0:n.id)||""),p(e.get("direction")||"up"),v(!1)})},[e]),(0,a.useEffect)(()=>{u&&h&&(N(!0),(0,c.zW)(u,h).then(j).catch(()=>j(null)).finally(()=>N(!1)))},[u,h]);let T=(e,n)=>{d(e),p(n),t.push("/enrichment?comparison=".concat(e,"&direction=").concat(n),{scroll:!1})},E=(0,a.useMemo)(()=>(null==g?void 0:g.data)?[...g.data].sort((e,t)=>(e["Adjusted P-value"]||1)-(t["Adjusted P-value"]||1)).slice(0,P):[],[g,P]),K=(0,a.useMemo)(()=>(function(e,t,n){let r=[...e];return r.sort((e,r)=>{let a=x(e,t),s=x(r,t);return a<s?"asc"===n?-1:1:a>s?"asc"===n?1:-1:0}),r})(E,O,k),[E,O,k]);return y?(0,r.jsx)(f,{}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"GO Enrichment Analysis"}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3 space-y-3",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:n.map(e=>(0,r.jsx)("button",{onClick:()=>T(e.id,h),className:"px-3 py-1.5 rounded text-xs font-medium ".concat(u===e.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-purple-100"),children:e.name.replace(/_/g," ")},e.id))}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:[(0,r.jsx)("button",{onClick:()=>T(u,"up"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("up"===h?"bg-red-500 text-white":"text-gray-600"),children:"Upregulated"}),(0,r.jsx)("button",{onClick:()=>T(u,"down"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("down"===h?"bg-blue-500 text-white":"text-gray-600"),children:"Downregulated"})]}),(0,r.jsx)("select",{value:P,onChange:e=>_(Number(e.target.value)),className:"px-2 py-1.5 border border-gray-300 rounded text-xs outline-none",children:[10,20,30,50].map(e=>(0,r.jsxs)("option",{value:e,children:["Top ",e]},e))}),(0,r.jsxs)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5 ml-auto",children:[(0,r.jsx)("button",{onClick:()=>S("chart"),className:"px-2 py-1 rounded text-xs font-medium ".concat("chart"===w?"bg-white shadow-sm":"text-gray-500"),children:"Chart"}),(0,r.jsx)("button",{onClick:()=>S("table"),className:"px-2 py-1 rounded text-xs font-medium ".concat("table"===w?"bg-white shadow-sm":"text-gray-500"),children:"Table"})]})]})]}),b?(0,r.jsx)(f,{}):K.length>0?(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[null==g?void 0:g.total_terms," enriched terms (",null==g?void 0:g.go_type,")"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["chart"===w&&(0,r.jsx)("button",{onClick:()=>C.current&&function(e,t){let n=new XMLSerializer().serializeToString(e),r=new Blob(['<?xml version="1.0" encoding="UTF-8"?>\n'.concat(n)],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=t,s.click(),URL.revokeObjectURL(a)}(C.current,"".concat(u,"_").concat(h,"_go_enrichment.svg")),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50",children:"Download SVG"}),(0,r.jsx)("button",{onClick:()=>(function(e,t){let n=new Blob([t.map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=e,a.click(),URL.revokeObjectURL(r)})("".concat(u,"_").concat(h,"_go_enrichment.csv"),function(e){let t=[["Term","Overlap","P-value","Adjusted P-value","Odds Ratio","Genes"]];return e.forEach(e=>{var n,r,a;return t.push([m(e.Term||""),e.Overlap||"",String(null!==(n=e["P-value"])&&void 0!==n?n:""),String(null!==(r=e["Adjusted P-value"])&&void 0!==r?r:""),String(null!==(a=e["Odds Ratio"])&&void 0!==a?a:""),(e.Genes||"").replace(/;/g,", ")])}),t}(K)),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50",children:"Download CSV"})]})]}),"chart"===w?(0,r.jsx)(o,{terms:K,direction:h,svgRef:C}):(0,r.jsx)(i,{terms:K,sortKey:O,sortDir:k,onSort:e=>{O===e?A("asc"===k?"desc":"asc"):(R(e),A("asc"))}})]}):(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center text-sm text-gray-500",children:"No enrichment data available for this selection."})]})}function o(e){let{terms:t,direction:n,svgRef:a}=e,s="up"===n?"#ef4444":"#3b82f6",c=Math.max(...t.map(e=>-Math.log10(e["Adjusted P-value"]||1))),l=22*t.length+30;return(0,r.jsxs)("svg",{ref:e=>{a.current=e},viewBox:"0 0 ".concat(740," ").concat(l),className:"w-full",style:{maxHeight:"700px"},children:[(0,r.jsx)("text",{x:490,y:l-4,textAnchor:"middle",fontSize:10,fill:"#6b7280",children:"-log₁₀(Adj. P-value)"}),t.map((e,t)=>{let n=-Math.log10(e["Adjusted P-value"]||1),a=n/c*380,l=22*t+6,o=m(e.Term||"");return(0,r.jsxs)("g",{children:[(0,r.jsx)("text",{x:294,y:l+9+3.5,textAnchor:"end",fontSize:9,fill:"#4b5563",children:o.length>55?o.slice(0,52)+"...":o}),(0,r.jsx)("rect",{x:300,y:l,width:a,height:18,fill:s,rx:2,opacity:.8}),(0,r.jsx)("text",{x:300+a+4,y:l+9+3.5,fontSize:8,fill:"#9ca3af",children:n.toFixed(1)})]},t)})]})}function i(e){let{terms:t,sortKey:n,sortDir:a,onSort:s}=e;return(0,r.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,r.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-600 w-6",children:"#"}),(0,r.jsx)(u,{label:"Term",sortKey:"Term",activeKey:n,dir:a,onSort:s,align:"left"}),(0,r.jsx)(u,{label:"Overlap",sortKey:"Overlap",activeKey:n,dir:a,onSort:s,align:"right",className:"w-16"}),(0,r.jsx)(u,{label:"P-value",sortKey:"P-value",activeKey:n,dir:a,onSort:s,align:"right",className:"w-24"}),(0,r.jsx)(u,{label:"Adj. P",sortKey:"Adjusted P-value",activeKey:n,dir:a,onSort:s,align:"right",className:"w-24"}),(0,r.jsx)(u,{label:"OR",sortKey:"Odds Ratio",activeKey:n,dir:a,onSort:s,align:"right",className:"w-16"}),(0,r.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-600",children:"Genes"})]})}),(0,r.jsx)("tbody",{children:t.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-2 py-1 text-gray-400",children:t+1}),(0,r.jsx)("td",{className:"px-2 py-1 text-gray-900 font-medium max-w-xs",children:m(e.Term||"")}),(0,r.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:e.Overlap||"-"}),(0,r.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:h(e["P-value"])}),(0,r.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:h(e["Adjusted P-value"])}),(0,r.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:e["Odds Ratio"]?e["Odds Ratio"].toFixed(1):"-"}),(0,r.jsx)("td",{className:"px-2 py-1 text-gray-500 max-w-[240px] align-top",children:(0,r.jsx)(d,{genes:e.Genes})})]},t))})]})}function u(e){let{label:t,sortKey:n,activeKey:a,dir:s,onSort:c,align:l,className:o}=e,i=a===n;return(0,r.jsx)("th",{className:"px-2 py-1.5 font-semibold text-gray-600 ".concat("right"===l?"text-right":"text-left"," ").concat(o||""),children:(0,r.jsxs)("button",{onClick:()=>c(n),className:"inline-flex items-center gap-1 hover:text-gray-900",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"text-[10px] text-gray-400",children:i?"asc"===s?"▲":"▼":"↕"})]})})}function d(e){let{genes:t}=e;if(!t)return(0,r.jsx)("span",{children:"-"});let n=t.split(";").filter(Boolean);return n.length<=5?(0,r.jsx)("span",{children:n.join(", ")}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"truncate",title:n.join(", "),children:[n.slice(0,5).join(", "),"..."]}),(0,r.jsxs)("details",{className:"mt-1",children:[(0,r.jsxs)("summary",{className:"cursor-pointer text-[10px] text-purple-600",children:["View all (",n.length,")"]}),(0,r.jsx)("div",{className:"mt-1 max-h-28 overflow-y-auto text-[10px] text-gray-600",children:n.join(", ")})]})]})}function x(e,t){var n,r,a;if("Term"===t)return(e.Term||"").toString();if("Overlap"===t){let[t,n]=(e.Overlap||"0/0").split("/").map(e=>Number(e));return n?t/n:0}return"P-value"===t?null!==(n=e["P-value"])&&void 0!==n?n:1:"Adjusted P-value"===t?null!==(r=e["Adjusted P-value"])&&void 0!==r?r:1:null!==(a=e["Odds Ratio"])&&void 0!==a?a:0}function m(e){return e.replace(/^GOBP_/,"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}function h(e){return null==e?"-":e<.001?e.toExponential(2):e.toFixed(4)}function f(){return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}function p(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(f,{}),children:(0,r.jsx)(l,{})})}},7268:function(e,t,n){"use strict";n.d(t,{Eh:function(){return m},I5:function(){return i},Ji:function(){return h},Mw:function(){return d},Z4:function(){return j},_r:function(){return u},ex:function(){return f},rY:function(){return p},sd:function(){return l},vj:function(){return o},wK:function(){return g},zW:function(){return x}});let r=()=>"/mrnapp-intersection",a=new Map;async function s(e){if(a.has(e))return a.get(e);let t=r(),n="".concat(t).concat(e),s=await fetch(n);if(!s.ok)throw Error("Failed to fetch ".concat(n,": ").concat(s.statusText));let c=await s.json();return a.set(e,c),c}async function c(e){return s(e)}async function l(){return c("/data/metadata.json")}async function o(){return c("/data/differential/comparison_list.json")}async function i(e){return c("/data/differential/results/".concat(e,".json"))}async function u(e){return c("/data/differential/volcano/".concat(e,".json"))}async function d(e){return c("/data/differential/significant/".concat(e,".json"))}async function x(e,t){return c("/data/enrichment/go/".concat(e).concat(t?"_".concat(t):"",".json"))}async function m(){return c("/data/intersection/index.json")}async function h(){return c("/data/intersection/gene_sets_summary.json")}function f(e){return[...e].sort().join("__")}async function p(e,t){let n=f(e);return c("/data/intersection/pairs/".concat(n,"_").concat(t,".json"))}async function g(e,t){let n=f(e);return c("/data/intersection/enrichment/".concat(n,"_").concat(t,"_enrichment.json"))}async function j(){return c("/data/gene-search/all_genes.json")}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8818)}),_N_E=e.O()}]);