(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{6924:function(e,t,n){Promise.resolve().then(n.bind(n,6204))},6204:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var s=n(7437),r=n(2265),a=n(7268);function l(){var e;let[t,n]=(0,r.useState)([]),[l,x]=(0,r.useState)([]),[u,m]=(0,r.useState)({}),[h,g]=(0,r.useState)([]),[p,f]=(0,r.useState)("up"),[j,b]=(0,r.useState)(null),[v,N]=(0,r.useState)(null),[y,w]=(0,r.useState)(!0),[_,S]=(0,r.useState)(!1),[k,E]=(0,r.useState)("sets"),[C,P]=(0,r.useState)(null);(0,r.useEffect)(()=>{Promise.all([(0,a.vj)(),(0,a.Eh)(),(0,a.Ji)()]).then(e=>{let[t,s,r]=e;n(t),x(s),m(r),t.length>=2&&g([t[0].id,t[1].id])}).finally(()=>w(!1))},[]);let M=(0,r.useCallback)(e=>{g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),O=(0,r.useMemo)(()=>{if(h.length<2)return!1;let e=(0,a.ex)(h);return l.some(t=>(t.comparisons_key||(0,a.ex)(t.comparisons))===e&&t.direction===p)},[h,p,l]),L=(0,r.useCallback)(async()=>{if(!(h.length<2)&&O){S(!0),P(null);try{let[e,t]=await Promise.all([(0,a.rY)(h,p),(0,a.wK)(h,p).catch(()=>null)]);b(e),N(t)}catch(e){P("Failed to load intersection data."),b(null),N(null)}finally{S(!1)}}},[h,p,O]);return((0,r.useEffect)(()=>{O?L():(b(null),N(null))},[O,L]),y)?(0,s.jsx)(o,{}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"Intersection Analysis"}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"Select comparisons (2–6)"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:t.map(e=>{let t=h.includes(e.id),n=u[e.id];return(0,s.jsxs)("button",{onClick:()=>M(e.id),className:"p-2 rounded border text-left text-xs transition-colors ".concat(t?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.name.replace(/_/g," ")}),(0,s.jsx)("div",{className:"w-4 h-4 rounded border flex items-center justify-center ".concat(t?"bg-purple-500 border-purple-500":"border-gray-300"),children:t&&(0,s.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),n&&(0,s.jsxs)("div",{className:"text-[10px] text-gray-400 mt-0.5",children:[(0,s.jsxs)("span",{className:"text-red-500",children:["↑",n.up]})," / ",(0,s.jsxs)("span",{className:"text-blue-500",children:["↓",n.down]})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:["up","down","both"].map(e=>(0,s.jsx)("button",{onClick:()=>f(e),className:"px-3 py-1.5 rounded text-xs font-medium ".concat(p===e?"up"===e?"bg-red-500 text-white":"down"===e?"bg-blue-500 text-white":"bg-purple-500 text-white":"text-gray-600"),children:"up"===e?"Up":"down"===e?"Down":"Both"},e))}),h.length<2&&(0,s.jsx)("span",{className:"text-xs text-amber-600",children:"Select at least 2"}),h.length>=2&&!O&&(0,s.jsx)("span",{className:"text-xs text-amber-600",children:"Not precomputed"})]})]}),_&&(0,s.jsx)(o,{}),C&&(0,s.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 text-amber-700 text-xs",children:C}),j&&!_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3 text-center",children:[(0,s.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-purple-700",children:Object.keys(j.set_sizes).length}),(0,s.jsx)("div",{className:"text-[10px] text-purple-500",children:"Sets"})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-green-700",children:j.all_intersection_count.toLocaleString()}),(0,s.jsx)("div",{className:"text-[10px] text-green-500",children:"Intersection"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-blue-700",children:j.all_union_count.toLocaleString()}),(0,s.jsx)("div",{className:"text-[10px] text-blue-500",children:"Union"})]}),(0,s.jsxs)("div",{className:"bg-orange-50 border border-orange-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-orange-700",children:j.jaccard_index.toFixed(3)}),(0,s.jsx)("div",{className:"text-[10px] text-orange-500",children:"Jaccard"})]})]}),(0,s.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5 w-fit",children:["sets","genes","enrichment"].map(e=>(0,s.jsx)("button",{onClick:()=>E(e),className:"px-3 py-1.5 rounded text-xs font-medium ".concat(k===e?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"sets"===e?"Set Sizes":"genes"===e?"Gene Lists":"Enrichment"},e))}),"sets"===k&&(0,s.jsx)(i,{result:j}),"genes"===k&&(0,s.jsx)(c,{result:j}),"enrichment"===k&&(0,s.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(null==v?void 0:null===(e=v.data)||void 0===e?void 0:e.length)?(0,s.jsx)(d,{data:v}):(0,s.jsx)("p",{className:"text-gray-500 text-sm text-center py-6",children:"No enrichment results for this intersection."})})]})]})}function i(e){let{result:t}=e,n=Object.entries(t.set_sizes),r=Math.max(...n.map(e=>{let[,t]=e;return t}));return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4 space-y-4",children:[(0,s.jsx)("div",{className:"space-y-2",children:n.map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-36 text-xs font-medium text-gray-700 text-right truncate",children:t.replace(/_/g," ")}),(0,s.jsx)("div",{className:"flex-1 bg-gray-100 rounded-full h-5 overflow-hidden",children:(0,s.jsx)("div",{className:"bg-purple-500 h-full rounded-full flex items-center justify-end pr-2",style:{width:"".concat(n/r*100,"%"),minWidth:"40px"},children:(0,s.jsx)("span",{className:"text-[10px] text-white font-medium",children:n.toLocaleString()})})})]},t)})}),t.pairwise_intersections&&Object.keys(t.pairwise_intersections).length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Pairwise Intersections"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(t.pairwise_intersections).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded px-3 py-1 text-xs",children:[(0,s.jsx)("span",{className:"text-gray-600 truncate mr-2",children:t.replace(/_/g," ")}),(0,s.jsx)("span",{className:"font-semibold text-purple-600",children:n.length})]},t)})})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded p-3 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-700",children:t.all_intersection_count}),(0,s.jsx)("div",{className:"text-xs text-green-600",children:"genes in common"})]})]})}function c(e){let{result:t}=e,[n,a]=(0,r.useState)(!1),l=t.all_intersection,i=n?l:l.slice(0,100);return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,s.jsxs)("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Intersection Genes (",l.length,")"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:i.map(e=>(0,s.jsx)("span",{className:"px-1.5 py-0.5 bg-green-50 text-green-800 rounded text-[10px] font-medium",children:e},e))}),l.length>100&&!n&&(0,s.jsxs)("button",{onClick:()=>a(!0),className:"text-xs text-purple-600 hover:underline mt-2",children:["Show all ",l.length,"..."]}),t.unique_to_set&&Object.keys(t.unique_to_set).length>0&&(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-600",children:"Unique to Each Set"}),Object.entries(t.unique_to_set).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-0.5",children:[t.replace(/_/g," ")," (",n.length," unique)"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-0.5 max-h-24 overflow-y-auto",children:[n.slice(0,40).map(e=>(0,s.jsx)("span",{className:"px-1 py-0.5 bg-gray-100 text-gray-600 rounded text-[10px]",children:e},e)),n.length>40&&(0,s.jsxs)("span",{className:"text-[10px] text-gray-400",children:["+",n.length-40]})]})]},t)})]})]})}function d(e){let{data:t}=e,n=(0,r.useMemo)(()=>[...t.data].sort((e,t)=>(e["Adjusted P-value"]||1)-(t["Adjusted P-value"]||1)).slice(0,20),[t]),a=Math.max(...n.map(e=>-Math.log10(e["Adjusted P-value"]||1)));return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-3",children:["Enrichment of ",t.intersection_genes_count," intersecting genes"]}),(0,s.jsx)("div",{className:"space-y-1",children:n.map((e,t)=>{var n;let r=-Math.log10(e["Adjusted P-value"]||1);return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-56 text-[10px] text-gray-700 text-right truncate",title:e.Term,children:(e.Term||"").replace(/^GOBP_/,"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}),(0,s.jsx)("div",{className:"flex-1 bg-gray-100 rounded-full h-4 overflow-hidden",children:(0,s.jsx)("div",{className:"bg-green-500 h-full rounded-full",style:{width:"".concat(r/a*100,"%"),minWidth:"2px"}})}),(0,s.jsx)("div",{className:"w-16 text-[10px] text-gray-500 text-right font-mono",children:null==(n=e["Adjusted P-value"])?"-":n<.001?n.toExponential(1):n.toFixed(3)})]},t)})})]})}function o(){return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}function x(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)(o,{}),children:(0,s.jsx)(l,{})})}},7268:function(e,t,n){"use strict";n.d(t,{Eh:function(){return m},I5:function(){return d},Ji:function(){return h},Mw:function(){return x},Z4:function(){return j},_r:function(){return o},ex:function(){return g},rY:function(){return p},sd:function(){return i},vj:function(){return c},wK:function(){return f},zW:function(){return u}});let s=()=>"/mrnapp-intersection",r=new Map;async function a(e){if(r.has(e))return r.get(e);let t=s(),n="".concat(t).concat(e),a=await fetch(n);if(!a.ok)throw Error("Failed to fetch ".concat(n,": ").concat(a.statusText));let l=await a.json();return r.set(e,l),l}async function l(e){return a(e)}async function i(){return l("/data/metadata.json")}async function c(){return l("/data/differential/comparison_list.json")}async function d(e){return l("/data/differential/results/".concat(e,".json"))}async function o(e){return l("/data/differential/volcano/".concat(e,".json"))}async function x(e){return l("/data/differential/significant/".concat(e,".json"))}async function u(e,t){return l("/data/enrichment/go/".concat(e).concat(t?"_".concat(t):"",".json"))}async function m(){return l("/data/intersection/index.json")}async function h(){return l("/data/intersection/gene_sets_summary.json")}function g(e){return[...e].sort().join("__")}async function p(e,t){let n=g(e);return l("/data/intersection/pairs/".concat(n,"_").concat(t,".json"))}async function f(e,t){let n=g(e);return l("/data/intersection/enrichment/".concat(n,"_").concat(t,"_enrichment.json"))}async function j(){return l("/data/gene-search/all_genes.json")}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=6924)}),_N_E=e.O()}]);