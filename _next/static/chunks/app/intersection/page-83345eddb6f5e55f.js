(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{6924:function(e,t,n){Promise.resolve().then(n.bind(n,6204))},6204:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var s=n(7437),r=n(2265),a=n(7268);function l(){var e;let[t,n]=(0,r.useState)([]),[l,x]=(0,r.useState)([]),[u,p]=(0,r.useState)({}),[j,f]=(0,r.useState)([]),[b,y]=(0,r.useState)("up"),[v,N]=(0,r.useState)(null),[w,_]=(0,r.useState)(null),[S,k]=(0,r.useState)(!0),[O,P]=(0,r.useState)(!1),[C,L]=(0,r.useState)("sets"),[R,A]=(0,r.useState)(null),[E,K]=(0,r.useState)("chart"),[T,U]=(0,r.useState)(50),[M,z]=(0,r.useState)("Adjusted P-value"),[F,G]=(0,r.useState)("asc"),B=(0,r.useRef)(null);(0,r.useEffect)(()=>{Promise.all([(0,a.vj)(),(0,a.Eh)(),(0,a.Ji)()]).then(e=>{let[t,s,r]=e;n(t),x(s),p(r),t.length>=2&&f([t[0].id,t[1].id])}).finally(()=>k(!1))},[]);let q=(0,r.useCallback)(e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),I=(0,r.useMemo)(()=>{if(j.length<2)return!1;let e=(0,a.ex)(j);return l.some(t=>(t.comparisons_key||(0,a.ex)(t.comparisons))===e&&t.direction===b)},[j,b,l]),D=(0,r.useCallback)(async()=>{if(!(j.length<2)&&I){P(!0),A(null);try{let[e,t]=await Promise.all([(0,a.rY)(j,b),(0,a.wK)(j,b).catch(()=>null)]);N(e),_(t)}catch(e){A("Failed to load intersection data."),N(null),_(null)}finally{P(!1)}}},[j,b,I]);(0,r.useEffect)(()=>{I?D():(N(null),_(null))},[I,D]);let J=(0,r.useMemo)(()=>(null==w?void 0:w.data)?[...w.data].sort((e,t)=>(e["Adjusted P-value"]||1)-(t["Adjusted P-value"]||1)).slice(0,T):[],[w,T]),V=(0,r.useMemo)(()=>(function(e,t,n){let s=[...e];return s.sort((e,s)=>{let r=m(e,t),a=m(s,t);return r<a?"asc"===n?-1:1:r>a?"asc"===n?1:-1:0}),s})(J,M,F),[J,M,F]);return S?(0,s.jsx)(g,{}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"Intersection Analysis"}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"Select comparisons (2–6)"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:t.map(e=>{let t=j.includes(e.id),n=u[e.id];return(0,s.jsxs)("button",{onClick:()=>q(e.id),className:"p-2 rounded border text-left text-xs transition-colors ".concat(t?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.name.replace(/_/g," ")}),(0,s.jsx)("div",{className:"w-4 h-4 rounded border flex items-center justify-center ".concat(t?"bg-purple-500 border-purple-500":"border-gray-300"),children:t&&(0,s.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),n&&(0,s.jsxs)("div",{className:"text-[10px] text-gray-400 mt-0.5",children:[(0,s.jsxs)("span",{className:"text-red-500",children:["↑",n.up]})," / ",(0,s.jsxs)("span",{className:"text-blue-500",children:["↓",n.down]})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:["up","down","both"].map(e=>(0,s.jsx)("button",{onClick:()=>y(e),className:"px-3 py-1.5 rounded text-xs font-medium ".concat(b===e?"up"===e?"bg-red-500 text-white":"down"===e?"bg-blue-500 text-white":"bg-purple-500 text-white":"text-gray-600"),children:"up"===e?"Up":"down"===e?"Down":"Both"},e))}),j.length<2&&(0,s.jsx)("span",{className:"text-xs text-amber-600",children:"Select at least 2"}),j.length>=2&&!I&&(0,s.jsx)("span",{className:"text-xs text-amber-600",children:"Not precomputed"})]})]}),O&&(0,s.jsx)(g,{}),R&&(0,s.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 text-amber-700 text-xs",children:R}),v&&!O&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3 text-center",children:[(0,s.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-purple-700",children:Object.keys(v.set_sizes).length}),(0,s.jsx)("div",{className:"text-[10px] text-purple-500",children:"Sets"})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-green-700",children:v.all_intersection_count.toLocaleString()}),(0,s.jsx)("div",{className:"text-[10px] text-green-500",children:"Intersection"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-blue-700",children:v.all_union_count.toLocaleString()}),(0,s.jsx)("div",{className:"text-[10px] text-blue-500",children:"Union"})]}),(0,s.jsxs)("div",{className:"bg-orange-50 border border-orange-100 rounded-lg p-2",children:[(0,s.jsx)("div",{className:"text-lg font-bold text-orange-700",children:v.jaccard_index.toFixed(3)}),(0,s.jsx)("div",{className:"text-[10px] text-orange-500",children:"Jaccard"})]})]}),(0,s.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5 w-fit",children:["sets","genes","enrichment"].map(e=>(0,s.jsx)("button",{onClick:()=>L(e),className:"px-3 py-1.5 rounded text-xs font-medium ".concat(C===e?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"sets"===e?"Set Sizes":"genes"===e?"Gene Lists":"Enrichment"},e))}),"sets"===C&&(0,s.jsx)(i,{result:v}),"genes"===C&&(0,s.jsx)(c,{result:v}),"enrichment"===C&&(0,s.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(null==w?void 0:null===(e=w.data)||void 0===e?void 0:e.length)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Enrichment of ",w.intersection_genes_count," intersecting genes"]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)("select",{value:T,onChange:e=>U(Number(e.target.value)),className:"px-2 py-1.5 border border-gray-300 rounded text-xs outline-none",children:[10,20,30,50].map(e=>(0,s.jsxs)("option",{value:e,children:["Top ",e]},e))}),(0,s.jsxs)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:[(0,s.jsx)("button",{onClick:()=>K("chart"),className:"px-3 py-1 rounded text-xs font-medium min-w-[64px] ".concat("chart"===E?"bg-white shadow-sm":"text-gray-500"),children:"Chart"}),(0,s.jsx)("button",{onClick:()=>K("table"),className:"px-3 py-1 rounded text-xs font-medium min-w-[64px] ".concat("table"===E?"bg-white shadow-sm":"text-gray-500"),children:"Table"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-3",children:[(0,s.jsx)("button",{onClick:()=>B.current&&function(e,t){let n=new XMLSerializer().serializeToString(e),s=new Blob(['<?xml version="1.0" encoding="UTF-8"?>\n'.concat(n)],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=t,a.click(),URL.revokeObjectURL(r)}(B.current,"".concat((0,a.ex)(j),"_").concat(b,"_intersection_enrichment.svg")),disabled:"chart"!==E,className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50 disabled:opacity-40 disabled:cursor-not-allowed min-w-[110px]",children:"Download SVG"}),(0,s.jsx)("button",{onClick:()=>(function(e,t){let n=new Blob([t.map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)})("".concat((0,a.ex)(j),"_").concat(b,"_intersection_enrichment.csv"),function(e){let t=[["Term","Overlap","P-value","Adjusted P-value","Odds Ratio","Genes"]];return e.forEach(e=>{var n,s,r;return t.push([h(e.Term||""),e.Overlap||"",String(null!==(n=e["P-value"])&&void 0!==n?n:""),String(null!==(s=e["Adjusted P-value"])&&void 0!==s?s:""),String(null!==(r=e["Odds Ratio"])&&void 0!==r?r:""),(e.Genes||"").replace(/;/g,", ")])}),t}(V)),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50 min-w-[110px]",children:"Download CSV"})]}),"chart"===E?(0,s.jsx)(o,{terms:V,svgRef:B}):(0,s.jsx)(d,{terms:V,sortKey:M,sortDir:F,onSort:e=>{M===e?G("asc"===F?"desc":"asc"):(z(e),G("asc"))}})]}):(0,s.jsx)("p",{className:"text-gray-500 text-sm text-center py-6",children:"No enrichment results for this intersection."})})]})]})}function i(e){let{result:t}=e,n=Object.entries(t.set_sizes),r=Math.max(...n.map(e=>{let[,t]=e;return t}));return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4 space-y-4",children:[(0,s.jsx)("div",{className:"space-y-2",children:n.map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-36 text-xs font-medium text-gray-700 text-right truncate",children:t.replace(/_/g," ")}),(0,s.jsx)("div",{className:"flex-1 bg-gray-100 rounded-full h-5 overflow-hidden",children:(0,s.jsx)("div",{className:"bg-purple-500 h-full rounded-full flex items-center justify-end pr-2",style:{width:"".concat(n/r*100,"%"),minWidth:"40px"},children:(0,s.jsx)("span",{className:"text-[10px] text-white font-medium",children:n.toLocaleString()})})})]},t)})}),t.pairwise_intersections&&Object.keys(t.pairwise_intersections).length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Pairwise Intersections"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(t.pairwise_intersections).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded px-3 py-1 text-xs",children:[(0,s.jsx)("span",{className:"text-gray-600 truncate mr-2",children:t.replace(/_/g," ")}),(0,s.jsx)("span",{className:"font-semibold text-purple-600",children:n.length})]},t)})})]}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded p-3 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-700",children:t.all_intersection_count}),(0,s.jsx)("div",{className:"text-xs text-green-600",children:"genes in common"})]})]})}function c(e){let{result:t}=e,[n,a]=(0,r.useState)(!1),l=t.all_intersection,i=n?l:l.slice(0,100);return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,s.jsxs)("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Intersection Genes (",l.length,")"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:i.map(e=>(0,s.jsx)("span",{className:"px-1.5 py-0.5 bg-green-50 text-green-800 rounded text-[10px] font-medium",children:e},e))}),l.length>100&&!n&&(0,s.jsxs)("button",{onClick:()=>a(!0),className:"text-xs text-purple-600 hover:underline mt-2",children:["Show all ",l.length,"..."]}),t.unique_to_set&&Object.keys(t.unique_to_set).length>0&&(0,s.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-600",children:"Unique to Each Set"}),Object.entries(t.unique_to_set).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-0.5",children:[t.replace(/_/g," ")," (",n.length," unique)"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-0.5 max-h-24 overflow-y-auto",children:[n.slice(0,40).map(e=>(0,s.jsx)("span",{className:"px-1 py-0.5 bg-gray-100 text-gray-600 rounded text-[10px]",children:e},e)),n.length>40&&(0,s.jsxs)("span",{className:"text-[10px] text-gray-400",children:["+",n.length-40]})]})]},t)})]})]})}function o(e){let{terms:t,svgRef:n}=e,r=Math.max(...t.map(e=>-Math.log10(e["Adjusted P-value"]||1))),a=22*t.length+30;return(0,s.jsxs)("svg",{ref:e=>{n.current=e},viewBox:"0 0 ".concat(740," ").concat(a),className:"w-full",style:{maxHeight:"700px"},children:[(0,s.jsx)("text",{x:490,y:a-4,textAnchor:"middle",fontSize:10,fill:"#6b7280",children:"-log₁₀(Adj. P-value)"}),t.map((e,t)=>{let n=-Math.log10(e["Adjusted P-value"]||1),a=n/r*380,l=22*t+6,i=h(e.Term||"");return(0,s.jsxs)("g",{children:[(0,s.jsx)("text",{x:294,y:l+9+3.5,textAnchor:"end",fontSize:9,fill:"#4b5563",children:i.length>55?i.slice(0,52)+"...":i}),(0,s.jsx)("rect",{x:300,y:l,width:a,height:18,fill:"#22c55e",rx:2,opacity:.85}),(0,s.jsx)("text",{x:300+a+4,y:l+9+3.5,fontSize:8,fill:"#9ca3af",children:n.toFixed(1)})]},t)})]})}function d(e){let{terms:t,sortKey:n,sortDir:r,onSort:a}=e;return(0,s.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,s.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-600 w-6",children:"#"}),(0,s.jsx)(x,{label:"Term",sortKey:"Term",activeKey:n,dir:r,onSort:a,align:"left"}),(0,s.jsx)(x,{label:"Overlap",sortKey:"Overlap",activeKey:n,dir:r,onSort:a,align:"right",className:"w-16"}),(0,s.jsx)(x,{label:"P-value",sortKey:"P-value",activeKey:n,dir:r,onSort:a,align:"right",className:"w-24"}),(0,s.jsx)(x,{label:"Adj. P",sortKey:"Adjusted P-value",activeKey:n,dir:r,onSort:a,align:"right",className:"w-24"}),(0,s.jsx)(x,{label:"OR",sortKey:"Odds Ratio",activeKey:n,dir:r,onSort:a,align:"right",className:"w-16"}),(0,s.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-600",children:"Genes"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-2 py-1 text-gray-400",children:t+1}),(0,s.jsx)("td",{className:"px-2 py-1 text-gray-900 font-medium max-w-xs",children:h(e.Term||"")}),(0,s.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:e.Overlap||"-"}),(0,s.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:p(e["P-value"])}),(0,s.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:p(e["Adjusted P-value"])}),(0,s.jsx)("td",{className:"px-2 py-1 text-right text-gray-600 font-mono tabular-nums",children:e["Odds Ratio"]?e["Odds Ratio"].toFixed(1):"-"}),(0,s.jsx)("td",{className:"px-2 py-1 text-gray-500 max-w-[240px] align-top",children:(0,s.jsx)(u,{genes:e.Genes})})]},t))})]})}function x(e){let{label:t,sortKey:n,activeKey:r,dir:a,onSort:l,align:i,className:c}=e,o=r===n;return(0,s.jsx)("th",{className:"px-2 py-1.5 font-semibold text-gray-600 ".concat("right"===i?"text-right":"text-left"," ").concat(c||""),children:(0,s.jsxs)("button",{onClick:()=>l(n),className:"inline-flex items-center gap-1 hover:text-gray-900",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-[10px] text-gray-400",children:o?"asc"===a?"▲":"▼":"↕"})]})})}function u(e){let{genes:t}=e;if(!t)return(0,s.jsx)("span",{children:"-"});let n=t.split(";").filter(Boolean);return n.length<=5?(0,s.jsx)("span",{children:n.join(", ")}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"truncate",title:n.join(", "),children:[n.slice(0,5).join(", "),"..."]}),(0,s.jsxs)("details",{className:"mt-1",children:[(0,s.jsxs)("summary",{className:"cursor-pointer text-[10px] text-purple-600",children:["View all (",n.length,")"]}),(0,s.jsx)("div",{className:"mt-1 max-h-28 overflow-y-auto text-[10px] text-gray-600",children:n.join(", ")})]})]})}function m(e,t){var n,s,r;if("Term"===t)return(e.Term||"").toString();if("Overlap"===t){let[t,n]=(e.Overlap||"0/0").split("/").map(e=>Number(e));return n?t/n:0}return"P-value"===t?null!==(n=e["P-value"])&&void 0!==n?n:1:"Adjusted P-value"===t?null!==(s=e["Adjusted P-value"])&&void 0!==s?s:1:null!==(r=e["Odds Ratio"])&&void 0!==r?r:0}function h(e){return e.replace(/^GOBP_/,"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}function p(e){return null==e?"-":e<.001?e.toExponential(1):e.toFixed(3)}function g(){return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}function j(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)(g,{}),children:(0,s.jsx)(l,{})})}},7268:function(e,t,n){"use strict";n.d(t,{Eh:function(){return m},I5:function(){return o},Ji:function(){return h},Mw:function(){return x},Z4:function(){return f},_r:function(){return d},ex:function(){return p},rY:function(){return g},sd:function(){return i},vj:function(){return c},wK:function(){return j},zW:function(){return u}});let s=()=>"/mrnapp-intersection",r=new Map;async function a(e){if(r.has(e))return r.get(e);let t=s(),n="".concat(t).concat(e),a=await fetch(n);if(!a.ok)throw Error("Failed to fetch ".concat(n,": ").concat(a.statusText));let l=await a.json();return r.set(e,l),l}async function l(e){return a(e)}async function i(){return l("/data/metadata.json")}async function c(){return l("/data/differential/comparison_list.json")}async function o(e){return l("/data/differential/results/".concat(e,".json"))}async function d(e){return l("/data/differential/volcano/".concat(e,".json"))}async function x(e){return l("/data/differential/significant/".concat(e,".json"))}async function u(e,t){return l("/data/enrichment/go/".concat(e).concat(t?"_".concat(t):"",".json"))}async function m(){return l("/data/intersection/index.json")}async function h(){return l("/data/intersection/gene_sets_summary.json")}function p(e){return[...e].sort().join("__")}async function g(e,t){let n=p(e);return l("/data/intersection/pairs/".concat(n,"_").concat(t,".json"))}async function j(e,t){let n=p(e);return l("/data/intersection/enrichment/".concat(n,"_").concat(t,"_enrichment.json"))}async function f(){return l("/data/gene-search/all_genes.json")}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=6924)}),_N_E=e.O()}]);