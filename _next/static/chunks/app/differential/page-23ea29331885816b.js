(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{2029:function(e,t,n){Promise.resolve().then(n.bind(n,7247))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},7247:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(7437),a=n(2265),s=n(9376),l=n(7268);function i(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),[n,i]=(0,a.useState)([]),[x,u]=(0,a.useState)(""),[h,f]=(0,a.useState)(null),[g,m]=(0,a.useState)(null),[p,y]=(0,a.useState)(null),[b,j]=(0,a.useState)(!0),[v,N]=(0,a.useState)(!1),[w,_]=(0,a.useState)("volcano"),[S,M]=(0,a.useState)("all"),[k,C]=(0,a.useState)(""),[P,F]=(0,a.useState)(1);(0,a.useEffect)(()=>{(0,l.vj)().then(t=>{var n;i(t);let r=e.get("comparison");u(r&&t.find(e=>e.id===r)?r:(null===(n=t[0])||void 0===n?void 0:n.id)||""),j(!1)})},[e]),(0,a.useEffect)(()=>{x&&(N(!0),f(null),m(null),y(null),Promise.all([(0,l.I5)(x),(0,l._r)(x),(0,l.Mw)(x)]).then(e=>{let[t,n,r]=e;f(t),m(n),y(r),F(1)}).catch(e=>{console.error("Failed to load differential data:",e)}).finally(()=>N(!1)))},[x]);let D=e=>{u(e),t.push("/differential?comparison=".concat(e),{scroll:!1})},E=(0,a.useMemo)(()=>{if(!(null==h?void 0:h.data))return[];let e=h.data;if("up"===S?e=e.filter(e=>"UP"===e.regulation):"down"===S&&(e=e.filter(e=>"DOWN"===e.regulation)),k){let t=k.toLowerCase();e=e.filter(e=>(e.gene_id||"").toLowerCase().includes(t)||(e.gene_name||"").toLowerCase().includes(t))}return e},[h,S,k]),z=Math.ceil(E.length/50),L=E.slice((P-1)*50,50*P);return b?(0,r.jsx)(d,{}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"Differential Expression Analysis"}),(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:n.map(e=>(0,r.jsxs)("button",{onClick:()=>D(e.id),className:"px-3 py-1.5 rounded text-xs font-medium transition-colors ".concat(x===e.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-purple-100"),children:[e.name.replace(/_/g," "),(0,r.jsxs)("span",{className:"ml-1 text-[10px] ".concat(x===e.id?"text-purple-200":"text-gray-400"),children:["(",e.source,")"]})]},e.id))})}),v?(0,r.jsx)(d,{}):(0,r.jsxs)(r.Fragment,{children:[p&&(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-gray-900",children:null==h?void 0:h.total_genes.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Total DEGs"})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg border border-red-100 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-red-600",children:p.upregulated_count.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-red-500",children:"Upregulated"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg border border-blue-100 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-blue-600",children:p.downregulated_count.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-blue-500",children:"Downregulated"})]})]}),(0,r.jsxs)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5 w-fit",children:[(0,r.jsx)("button",{onClick:()=>_("volcano"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("volcano"===w?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"Volcano Plot"}),(0,r.jsx)("button",{onClick:()=>_("table"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("table"===w?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"Data Table"})]}),"volcano"===w&&g&&(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,r.jsx)(o,{data:g})}),"table"===w&&h&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[E.length.toLocaleString()," genes"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:["all","up","down"].map(e=>(0,r.jsx)("button",{onClick:()=>{M(e),F(1)},className:"px-2 py-1 rounded text-[11px] font-medium ".concat(S===e?"up"===e?"bg-red-500 text-white":"down"===e?"bg-blue-500 text-white":"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"all"===e?"All":"up"===e?"Up":"Down"},e))}),(0,r.jsx)("input",{type:"text",placeholder:"Search gene...",value:k,onChange:e=>{C(e.target.value),F(1)},className:"px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-purple-500 outline-none w-40"})]})]}),(0,r.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,r.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-600 w-48",children:"Gene ID"}),(0,r.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-600 w-32",children:"Gene Name"}),(0,r.jsx)("th",{className:"px-3 py-2 text-right font-semibold text-gray-600 w-24",children:"log₂FC"}),(0,r.jsx)("th",{className:"px-3 py-2 text-right font-semibold text-gray-600 w-28",children:"P-value"}),(0,r.jsx)("th",{className:"px-3 py-2 text-right font-semibold text-gray-600 w-28",children:"Q-value"}),(0,r.jsx)("th",{className:"px-3 py-2 text-center font-semibold text-gray-600 w-20",children:"Status"})]})}),(0,r.jsx)("tbody",{children:L.map((e,t)=>{var n,a;return(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-1.5 font-mono text-gray-600",children:e.gene_id}),(0,r.jsx)("td",{className:"px-3 py-1.5 font-medium text-gray-900",children:e.gene_name||"-"}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums ".concat(e.log2FC>0?"text-red-600":e.log2FC<0?"text-blue-600":"text-gray-500"),children:null!==(a=null==(n=e.log2FC)?void 0:n.toFixed(4))&&void 0!==a?a:"-"}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums text-gray-600",children:c(e.pvalue)}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums text-gray-600",children:c(e.qvalue)}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-center",children:(0,r.jsx)("span",{className:"inline-block px-1.5 py-0.5 rounded text-[10px] font-semibold ".concat("UP"===e.regulation?"bg-red-100 text-red-700":"DOWN"===e.regulation?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-500"),children:e.regulation})})]},t)})})]}),z>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100 text-xs",children:[(0,r.jsxs)("span",{className:"text-gray-500",children:["Page ",P," / ",z]}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("button",{onClick:()=>F(e=>Math.max(1,e-1)),disabled:1===P,className:"px-2 py-1 rounded border border-gray-300 disabled:opacity-30 hover:bg-gray-50",children:"Prev"}),(function(e,t){if(t<=7)return Array.from({length:t},(e,t)=>t+1);let n=[1];e>3&&n.push("...");for(let r=Math.max(2,e-1);r<=Math.min(t-1,e+1);r++)n.push(r);return e<t-2&&n.push("..."),n.push(t),n})(P,z).map((e,t)=>"..."===e?(0,r.jsx)("span",{className:"px-1 text-gray-400",children:"..."},"e".concat(t)):(0,r.jsx)("button",{onClick:()=>F(e),className:"px-2 py-1 rounded ".concat(P===e?"bg-purple-600 text-white":"border border-gray-300 hover:bg-gray-50"),children:e},e)),(0,r.jsx)("button",{onClick:()=>F(e=>Math.min(z,e+1)),disabled:P===z,className:"px-2 py-1 rounded border border-gray-300 disabled:opacity-30 hover:bg-gray-50",children:"Next"})]})]})]})]})]})}function o(e){let{data:t}=e,[n,s]=(0,a.useState)(null),[l,i]=(0,a.useState)({x:0,y:0}),{xMin:o,xMax:d,yMax:x,genes:u}=(0,a.useMemo)(()=>{let e=t.genes,n=e.map(e=>e.log2FC),r=e.map(e=>e.neg_log10_pvalue);return{genes:e,xMin:Math.min(...n)-.5,xMax:Math.max(...n)+.5,yMax:Math.min(1.1*Math.max(...r),350)}},[t]),h=e=>55+(e-o)/(d-o)*720,f=e=>435-Math.min(e,x)/x*420,g=(0,a.useMemo)(()=>{if(u.length<=5e3)return u;let e=u.filter(e=>"not_significant"!==e.significance),t=u.filter(e=>"not_significant"===e.significance),n=Math.min(t.length,5e3-e.length),r=Math.floor(t.length/n);return[...e,...t.filter((e,t)=>t%r==0).slice(0,n)]},[u]),m=(0,a.useMemo)(()=>{let e=Math.ceil((d-o)/8),t=[];for(let n=Math.ceil(o);n<=Math.floor(d);n+=e)t.push(n);return t},[o,d]),p=(0,a.useMemo)(()=>{let e=Math.ceil(x/6),t=[];for(let n=0;n<=x;n+=e)t.push(n);return t},[x]);return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("svg",{viewBox:"0 0 ".concat(800," ").concat(480),className:"w-full",children:[(0,r.jsx)("rect",{x:55,y:15,width:720,height:420,fill:"#fafafa",rx:2}),(0,r.jsx)("line",{x1:h(-t.log2fc_threshold),y1:15,x2:h(-t.log2fc_threshold),y2:435,stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:h(t.log2fc_threshold),y1:15,x2:h(t.log2fc_threshold),y2:435,stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:55,y1:f(-Math.log10(t.pvalue_threshold)),x2:775,y2:f(-Math.log10(t.pvalue_threshold)),stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:55,y1:435,x2:775,y2:435,stroke:"#9ca3af"}),m.map(e=>(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:h(e),y1:435,x2:h(e),y2:439,stroke:"#9ca3af"}),(0,r.jsx)("text",{x:h(e),y:451,textAnchor:"middle",fontSize:10,fill:"#6b7280",children:e})]},e)),(0,r.jsx)("text",{x:415,y:476,textAnchor:"middle",fontSize:11,fill:"#374151",children:"log₂(Fold Change)"}),(0,r.jsx)("line",{x1:55,y1:15,x2:55,y2:435,stroke:"#9ca3af"}),p.map(e=>(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:51,y1:f(e),x2:55,y2:f(e),stroke:"#9ca3af"}),(0,r.jsx)("text",{x:48,y:f(e)+3,textAnchor:"end",fontSize:10,fill:"#6b7280",children:e})]},e)),(0,r.jsx)("text",{transform:"translate(12,".concat(225,") rotate(-90)"),textAnchor:"middle",fontSize:11,fill:"#374151",children:"-log₁₀(P-value)"}),g.map((e,t)=>(0,r.jsx)("circle",{cx:h(e.log2FC),cy:f(e.neg_log10_pvalue),r:"not_significant"===e.significance?1.5:2.5,fill:"up"===e.significance?"#ef4444":"down"===e.significance?"#3b82f6":"#d1d5db",opacity:"not_significant"===e.significance?.3:.7,onMouseEnter:t=>{var n;s(e);let r=null===(n=t.currentTarget.ownerSVGElement)||void 0===n?void 0:n.getBoundingClientRect();r&&i({x:t.clientX-r.left,y:t.clientY-r.top-10})},onMouseLeave:()=>s(null),className:"cursor-pointer hover:opacity-100"},t)),(0,r.jsxs)("g",{transform:"translate(".concat(63,", ").concat(23,")"),children:[(0,r.jsx)("rect",{width:100,height:56,fill:"white",fillOpacity:.9,rx:3,stroke:"#f3f4f6"}),(0,r.jsx)("circle",{cx:12,cy:12,r:3.5,fill:"#ef4444"}),(0,r.jsx)("text",{x:22,y:15,fontSize:9,fill:"#374151",children:"Upregulated"}),(0,r.jsx)("circle",{cx:12,cy:28,r:3.5,fill:"#3b82f6"}),(0,r.jsx)("text",{x:22,y:31,fontSize:9,fill:"#374151",children:"Downregulated"}),(0,r.jsx)("circle",{cx:12,cy:44,r:3.5,fill:"#d1d5db"}),(0,r.jsx)("text",{x:22,y:47,fontSize:9,fill:"#374151",children:"Not significant"})]})]}),n&&(0,r.jsxs)("div",{className:"absolute z-50 bg-gray-900 text-white px-2 py-1.5 rounded shadow-lg text-[11px] pointer-events-none whitespace-nowrap",style:{left:l.x,top:l.y,transform:"translate(-50%, -100%)"},children:[(0,r.jsx)("div",{className:"font-bold",children:n.gene}),(0,r.jsxs)("div",{children:["log₂FC: ",n.log2FC.toFixed(4)," | P: ",c(n.pvalue)]})]})]})}function c(e){return null==e?"-":0===e?"0":e<.001?e.toExponential(2):e.toFixed(4)}function d(){return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}function x(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(d,{}),children:(0,r.jsx)(i,{})})}},7268:function(e,t,n){"use strict";n.d(t,{Eh:function(){return h},I5:function(){return c},Ji:function(){return f},Mw:function(){return x},Z4:function(){return y},_r:function(){return d},ex:function(){return g},rY:function(){return m},sd:function(){return i},vj:function(){return o},wK:function(){return p},zW:function(){return u}});let r=()=>"/mrnapp-intersection",a=new Map;async function s(e){if(a.has(e))return a.get(e);let t=r(),n="".concat(t).concat(e),s=await fetch(n);if(!s.ok)throw Error("Failed to fetch ".concat(n,": ").concat(s.statusText));let l=await s.json();return a.set(e,l),l}async function l(e){return s(e)}async function i(){return l("/data/metadata.json")}async function o(){return l("/data/differential/comparison_list.json")}async function c(e){return l("/data/differential/results/".concat(e,".json"))}async function d(e){return l("/data/differential/volcano/".concat(e,".json"))}async function x(e){return l("/data/differential/significant/".concat(e,".json"))}async function u(e,t){return l("/data/enrichment/go/".concat(e).concat(t?"_".concat(t):"",".json"))}async function h(){return l("/data/intersection/index.json")}async function f(){return l("/data/intersection/gene_sets_summary.json")}function g(e){return[...e].sort().join("__")}async function m(e,t){let n=g(e);return l("/data/intersection/pairs/".concat(n,"_").concat(t,".json"))}async function p(e,t){let n=g(e);return l("/data/intersection/enrichment/".concat(n,"_").concat(t,"_enrichment.json"))}async function y(){return l("/data/gene-search/all_genes.json")}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2029)}),_N_E=e.O()}]);