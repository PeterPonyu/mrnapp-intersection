(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{2029:function(e,t,n){Promise.resolve().then(n.bind(n,7247))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},7247:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(7437),a=n(2265),l=n(9376),s=n(7268);function o(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),[n,o]=(0,a.useState)([]),[h,f]=(0,a.useState)(""),[m,p]=(0,a.useState)(null),[y,b]=(0,a.useState)(null),[j,v]=(0,a.useState)(null),[N,w]=(0,a.useState)(!0),[_,S]=(0,a.useState)(!1),[C,k]=(0,a.useState)("volcano"),[M,F]=(0,a.useState)("all"),[L,P]=(0,a.useState)(""),[E,D]=(0,a.useState)(1),[R,U]=(0,a.useState)("qvalue"),[K,z]=(0,a.useState)("asc"),O=(0,a.useRef)(null),q=(e,t)=>{U(e),z(t)};(0,a.useEffect)(()=>{(0,s.vj)().then(t=>{var n;o(t);let r=e.get("comparison");f(r&&t.find(e=>e.id===r)?r:(null===(n=t[0])||void 0===n?void 0:n.id)||""),w(!1)})},[e]),(0,a.useEffect)(()=>{h&&(S(!0),p(null),b(null),v(null),Promise.all([(0,s.I5)(h),(0,s._r)(h),(0,s.Mw)(h)]).then(e=>{let[t,n,r]=e;p(t),b(n),v(r),D(1)}).catch(e=>{console.error("Failed to load differential data:",e)}).finally(()=>S(!1)))},[h]);let A=e=>{f(e),t.push("/differential?comparison=".concat(e),{scroll:!1})},T=(0,a.useMemo)(()=>{if(!(null==m?void 0:m.data))return[];let e=m.data;if("up"===M?e=e.filter(e=>"UP"===e.regulation):"down"===M&&(e=e.filter(e=>"DOWN"===e.regulation)),L){let t=L.toLowerCase();e=e.filter(e=>(e.gene_id||"").toLowerCase().includes(t)||(e.gene_name||"").toLowerCase().includes(t))}return e},[m,M,L]),G=(0,a.useMemo)(()=>{let e=[...T];return e.sort((e,t)=>(function(e,t,n,r){let a=u(e,n),l=u(t,n);return a<l?"asc"===r?-1:1:a>l?"asc"===r?1:-1:0})(e,t,R,K)),e},[T,R,K]),V=Math.ceil(G.length/50),B=G.slice((E-1)*50,50*E);return N?(0,r.jsx)(d,{}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:"Differential Expression Analysis"}),(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:n.map(e=>(0,r.jsxs)("button",{onClick:()=>A(e.id),className:"px-3 py-1.5 rounded text-xs font-medium transition-colors ".concat(h===e.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-purple-100"),children:[e.name.replace(/_/g," "),(0,r.jsxs)("span",{className:"ml-1 text-[10px] ".concat(h===e.id?"text-purple-200":"text-gray-400"),children:["(",e.source,")"]})]},e.id))})}),_?(0,r.jsx)(d,{}):(0,r.jsxs)(r.Fragment,{children:[j&&(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-gray-900",children:null==m?void 0:m.total_genes.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Total DEGs"})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg border border-red-100 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-red-600",children:j.upregulated_count.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-red-500",children:"Upregulated"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg border border-blue-100 p-3 text-center",children:[(0,r.jsx)("div",{className:"text-xl font-bold text-blue-600",children:j.downregulated_count.toLocaleString()}),(0,r.jsx)("div",{className:"text-xs text-blue-500",children:"Downregulated"})]})]}),(0,r.jsxs)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5 w-fit",children:[(0,r.jsx)("button",{onClick:()=>k("volcano"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("volcano"===C?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"Volcano Plot"}),(0,r.jsx)("button",{onClick:()=>k("table"),className:"px-3 py-1.5 rounded text-xs font-medium ".concat("table"===C?"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"Data Table"})]}),"volcano"===C&&y&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-3",children:[(0,r.jsx)("button",{onClick:()=>O.current&&function(e,t){let n=new XMLSerializer().serializeToString(e),r=new Blob(['<?xml version="1.0" encoding="UTF-8"?>\n'.concat(n)],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download=t,l.click(),URL.revokeObjectURL(a)}(O.current,"".concat(h,"_volcano.svg")),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50",children:"Download SVG"}),(0,r.jsx)("button",{onClick:()=>g("".concat(h,"_volcano.csv"),function(e){let t=[["gene","log2FC","pvalue","neg_log10_pvalue","significance"]];return e.genes.forEach(e=>t.push([e.gene,String(e.log2FC),String(e.pvalue),String(e.neg_log10_pvalue),e.significance])),t}(y)),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50",children:"Download CSV"})]}),(0,r.jsx)(i,{data:y,svgRef:O})]}),"table"===C&&m&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[G.length.toLocaleString()," genes"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>g("".concat(h,"_differential.csv"),function(e){let t=[["gene_id","gene_name","log2FC","pvalue","qvalue","regulation"]];return e.forEach(e=>{var n,r,a;return t.push([e.gene_id||"",e.gene_name||"",String(null!==(n=e.log2FC)&&void 0!==n?n:""),String(null!==(r=e.pvalue)&&void 0!==r?r:""),String(null!==(a=e.qvalue)&&void 0!==a?a:""),e.regulation||""])}),t}(G)),className:"px-2 py-1 rounded text-xs border border-gray-300 hover:bg-gray-50",children:"Download CSV"}),(0,r.jsx)("div",{className:"flex space-x-0.5 bg-gray-100 rounded p-0.5",children:["all","up","down"].map(e=>(0,r.jsx)("button",{onClick:()=>{F(e),D(1)},className:"px-2 py-1 rounded text-[11px] font-medium ".concat(M===e?"up"===e?"bg-red-500 text-white":"down"===e?"bg-blue-500 text-white":"bg-white shadow-sm text-gray-900":"text-gray-500"),children:"all"===e?"All":"up"===e?"Up":"Down"},e))}),(0,r.jsx)("input",{type:"text",placeholder:"Search gene...",value:L,onChange:e=>{P(e.target.value),D(1)},className:"px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-purple-500 outline-none w-40"})]})]}),(0,r.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,r.jsx)(x,{label:"Gene ID",sortKey:"gene_id",activeKey:R,dir:K,onSort:q,align:"left",className:"w-48"}),(0,r.jsx)(x,{label:"Gene Name",sortKey:"gene_name",activeKey:R,dir:K,onSort:q,align:"left",className:"w-32"}),(0,r.jsx)(x,{label:"log₂FC",sortKey:"log2FC",activeKey:R,dir:K,onSort:q,align:"right",className:"w-24"}),(0,r.jsx)(x,{label:"P-value",sortKey:"pvalue",activeKey:R,dir:K,onSort:q,align:"right",className:"w-28"}),(0,r.jsx)(x,{label:"Q-value",sortKey:"qvalue",activeKey:R,dir:K,onSort:q,align:"right",className:"w-28"}),(0,r.jsx)(x,{label:"Status",sortKey:"regulation",activeKey:R,dir:K,onSort:q,align:"center",className:"w-20"})]})}),(0,r.jsx)("tbody",{children:B.map((e,t)=>{var n,a;return(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-1.5 font-mono text-gray-600",children:e.gene_id}),(0,r.jsx)("td",{className:"px-3 py-1.5 font-medium text-gray-900",children:e.gene_name||"-"}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums ".concat(e.log2FC>0?"text-red-600":e.log2FC<0?"text-blue-600":"text-gray-500"),children:null!==(a=null==(n=e.log2FC)?void 0:n.toFixed(4))&&void 0!==a?a:"-"}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums text-gray-600",children:c(e.pvalue)}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-right font-mono tabular-nums text-gray-600",children:c(e.qvalue)}),(0,r.jsx)("td",{className:"px-3 py-1.5 text-center",children:(0,r.jsx)("span",{className:"inline-block px-1.5 py-0.5 rounded text-[10px] font-semibold ".concat("UP"===e.regulation?"bg-red-100 text-red-700":"DOWN"===e.regulation?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-500"),children:e.regulation})})]},t)})})]}),V>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100 text-xs",children:[(0,r.jsxs)("span",{className:"text-gray-500",children:["Page ",E," / ",V]}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("button",{onClick:()=>D(e=>Math.max(1,e-1)),disabled:1===E,className:"px-2 py-1 rounded border border-gray-300 disabled:opacity-30 hover:bg-gray-50",children:"Prev"}),(function(e,t){if(t<=7)return Array.from({length:t},(e,t)=>t+1);let n=[1];e>3&&n.push("...");for(let r=Math.max(2,e-1);r<=Math.min(t-1,e+1);r++)n.push(r);return e<t-2&&n.push("..."),n.push(t),n})(E,V).map((e,t)=>"..."===e?(0,r.jsx)("span",{className:"px-1 text-gray-400",children:"..."},"e".concat(t)):(0,r.jsx)("button",{onClick:()=>D(e),className:"px-2 py-1 rounded ".concat(E===e?"bg-purple-600 text-white":"border border-gray-300 hover:bg-gray-50"),children:e},e)),(0,r.jsx)("button",{onClick:()=>D(e=>Math.min(V,e+1)),disabled:E===V,className:"px-2 py-1 rounded border border-gray-300 disabled:opacity-30 hover:bg-gray-50",children:"Next"})]})]})]})]})]})}function i(e){let{data:t,svgRef:n}=e,[l,s]=(0,a.useState)(null),[o,i]=(0,a.useState)({x:0,y:0}),{xMin:d,xMax:u,yMax:x,genes:g}=(0,a.useMemo)(()=>{let e=t.genes,n=e.map(e=>e.log2FC),r=e.map(e=>e.neg_log10_pvalue);return{genes:e,xMin:Math.min(...n)-.5,xMax:Math.max(...n)+.5,yMax:Math.min(1.1*Math.max(...r),350)}},[t]),h=e=>55+(e-d)/(u-d)*720,f=e=>435-Math.min(e,x)/x*420,m=(0,a.useMemo)(()=>{if(g.length<=5e3)return g;let e=g.filter(e=>"not_significant"!==e.significance),t=g.filter(e=>"not_significant"===e.significance),n=Math.min(t.length,5e3-e.length),r=Math.floor(t.length/n);return[...e,...t.filter((e,t)=>t%r==0).slice(0,n)]},[g]),p=(0,a.useMemo)(()=>{let e=Math.ceil((u-d)/8),t=[];for(let n=Math.ceil(d);n<=Math.floor(u);n+=e)t.push(n);return t},[d,u]),y=(0,a.useMemo)(()=>{let e=Math.ceil(x/6),t=[];for(let n=0;n<=x;n+=e)t.push(n);return t},[x]);return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("svg",{ref:e=>{n.current=e},viewBox:"0 0 ".concat(800," ").concat(480),className:"w-full",children:[(0,r.jsx)("rect",{x:55,y:15,width:720,height:420,fill:"#fafafa",rx:2}),(0,r.jsx)("line",{x1:h(-t.log2fc_threshold),y1:15,x2:h(-t.log2fc_threshold),y2:435,stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:h(t.log2fc_threshold),y1:15,x2:h(t.log2fc_threshold),y2:435,stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:55,y1:f(-Math.log10(t.pvalue_threshold)),x2:775,y2:f(-Math.log10(t.pvalue_threshold)),stroke:"#e5e7eb",strokeDasharray:"3,3"}),(0,r.jsx)("line",{x1:55,y1:435,x2:775,y2:435,stroke:"#9ca3af"}),p.map(e=>(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:h(e),y1:435,x2:h(e),y2:439,stroke:"#9ca3af"}),(0,r.jsx)("text",{x:h(e),y:451,textAnchor:"middle",fontSize:10,fill:"#6b7280",children:e})]},e)),(0,r.jsx)("text",{x:415,y:476,textAnchor:"middle",fontSize:11,fill:"#374151",children:"log₂(Fold Change)"}),(0,r.jsx)("line",{x1:55,y1:15,x2:55,y2:435,stroke:"#9ca3af"}),y.map(e=>(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:51,y1:f(e),x2:55,y2:f(e),stroke:"#9ca3af"}),(0,r.jsx)("text",{x:48,y:f(e)+3,textAnchor:"end",fontSize:10,fill:"#6b7280",children:e})]},e)),(0,r.jsx)("text",{transform:"translate(12,".concat(225,") rotate(-90)"),textAnchor:"middle",fontSize:11,fill:"#374151",children:"-log₁₀(P-value)"}),m.map((e,t)=>(0,r.jsx)("circle",{cx:h(e.log2FC),cy:f(e.neg_log10_pvalue),r:"not_significant"===e.significance?1.5:2.5,fill:"up"===e.significance?"#ef4444":"down"===e.significance?"#3b82f6":"#d1d5db",opacity:"not_significant"===e.significance?.3:.7,onMouseEnter:t=>{var n;s(e);let r=null===(n=t.currentTarget.ownerSVGElement)||void 0===n?void 0:n.getBoundingClientRect();r&&i({x:t.clientX-r.left,y:t.clientY-r.top-10})},onMouseLeave:()=>s(null),className:"cursor-pointer hover:opacity-100"},t)),(0,r.jsxs)("g",{transform:"translate(".concat(63,", ").concat(23,")"),children:[(0,r.jsx)("rect",{width:100,height:56,fill:"white",fillOpacity:.9,rx:3,stroke:"#f3f4f6"}),(0,r.jsx)("circle",{cx:12,cy:12,r:3.5,fill:"#ef4444"}),(0,r.jsx)("text",{x:22,y:15,fontSize:9,fill:"#374151",children:"Upregulated"}),(0,r.jsx)("circle",{cx:12,cy:28,r:3.5,fill:"#3b82f6"}),(0,r.jsx)("text",{x:22,y:31,fontSize:9,fill:"#374151",children:"Downregulated"}),(0,r.jsx)("circle",{cx:12,cy:44,r:3.5,fill:"#d1d5db"}),(0,r.jsx)("text",{x:22,y:47,fontSize:9,fill:"#374151",children:"Not significant"})]})]}),l&&(0,r.jsxs)("div",{className:"absolute z-50 bg-gray-900 text-white px-2 py-1.5 rounded shadow-lg text-[11px] pointer-events-none whitespace-nowrap",style:{left:o.x,top:o.y,transform:"translate(-50%, -100%)"},children:[(0,r.jsx)("div",{className:"font-bold",children:l.gene}),(0,r.jsxs)("div",{children:["log₂FC: ",l.log2FC.toFixed(4)," | P: ",c(l.pvalue)]})]})]})}function c(e){return null==e?"-":0===e?"0":e<.001?e.toExponential(2):e.toFixed(4)}function d(){return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}function u(e,t){var n,r,a;return"gene_id"===t?(e.gene_id||"").toString():"gene_name"===t?(e.gene_name||"").toString():"log2FC"===t?null!==(n=e.log2FC)&&void 0!==n?n:0:"pvalue"===t?null!==(r=e.pvalue)&&void 0!==r?r:1:"qvalue"===t?null!==(a=e.qvalue)&&void 0!==a?a:1:(e.regulation||"").toString()}function x(e){let{label:t,sortKey:n,activeKey:a,dir:l,onSort:s,align:o,className:i}=e,c=a===n;return(0,r.jsx)("th",{className:"px-3 py-2 font-semibold text-gray-600 ".concat("right"===o?"text-right":"center"===o?"text-center":"text-left"," ").concat(i||""),children:(0,r.jsxs)("button",{onClick:()=>s(n,c&&"asc"===l?"desc":"asc"),className:"inline-flex items-center gap-1 hover:text-gray-900",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"text-[10px] text-gray-400",children:c?"asc"===l?"▲":"▼":"↕"})]})})}function g(e,t){let n=new Blob([t.map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=e,a.click(),URL.revokeObjectURL(r)}function h(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(d,{}),children:(0,r.jsx)(o,{})})}},7268:function(e,t,n){"use strict";n.d(t,{Eh:function(){return g},I5:function(){return c},Ji:function(){return h},Mw:function(){return u},Z4:function(){return y},_r:function(){return d},ex:function(){return f},rY:function(){return m},sd:function(){return o},vj:function(){return i},wK:function(){return p},zW:function(){return x}});let r=()=>"/mrnapp-intersection",a=new Map;async function l(e){if(a.has(e))return a.get(e);let t=r(),n="".concat(t).concat(e),l=await fetch(n);if(!l.ok)throw Error("Failed to fetch ".concat(n,": ").concat(l.statusText));let s=await l.json();return a.set(e,s),s}async function s(e){return l(e)}async function o(){return s("/data/metadata.json")}async function i(){return s("/data/differential/comparison_list.json")}async function c(e){return s("/data/differential/results/".concat(e,".json"))}async function d(e){return s("/data/differential/volcano/".concat(e,".json"))}async function u(e){return s("/data/differential/significant/".concat(e,".json"))}async function x(e,t){return s("/data/enrichment/go/".concat(e).concat(t?"_".concat(t):"",".json"))}async function g(){return s("/data/intersection/index.json")}async function h(){return s("/data/intersection/gene_sets_summary.json")}function f(e){return[...e].sort().join("__")}async function m(e,t){let n=f(e);return s("/data/intersection/pairs/".concat(n,"_").concat(t,".json"))}async function p(e,t){let n=f(e);return s("/data/intersection/enrichment/".concat(n,"_").concat(t,"_enrichment.json"))}async function y(){return s("/data/gene-search/all_genes.json")}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2029)}),_N_E=e.O()}]);